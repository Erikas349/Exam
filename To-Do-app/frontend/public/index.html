<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Todo List with Delete & Check</title>
</head>
<body>
<h1>Todo List</h1>

<input type="text" id="taskInput" placeholder="Enter new task" />
<button onclick="addTask()">Add</button>

<ul id="taskList"></ul>

<script>
const backendUrl = 'http://3.71.116.203:5000';

async function loadTasks() {
    const res = await fetch(`${backendUrl}/todos`);
    const tasks = await res.json();
    const list = document.getElementById('taskList');
    list.innerHTML = '';

    tasks.forEach(task => {
        const li = document.createElement('li');
        
        // Checkbox for done/undone
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = task.done;
        checkbox.onclick = () => toggleDone(task.id, checkbox.checked);

        // Task text with line-through if done
        const span = document.createElement('span');
        span.textContent = task.task;
        span.style.textDecoration = task.done ? 'line-through' : 'none';
        span.style.margin = '0 10px';

        // Delete button
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = () => deleteTask(task.id);

        li.appendChild(checkbox);
        li.appendChild(span);
        li.appendChild(delBtn);
        list.appendChild(li);
    });
}

async function addTask() {
    const input = document.getElementById('taskInput');
    const task = input.value.trim();
    if (!task) {
        alert('Please enter a task.');
        return;
    }
    const res = await fetch(`${backendUrl}/todos`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({task})
    });
    if (res.ok) {
        input.value = '';
        loadTasks();
    } else {
        alert('Failed to add task');
    }
}

async function deleteTask(id) {
    if (!confirm('Delete this task?')) return;
    const res = await fetch(`${backendUrl}/todos/${id}`, { method: 'DELETE' });
    if (res.ok) loadTasks();
    else alert('Failed to delete task');
}

async function toggleDone(id, done) {
    const res = await fetch(`${backendUrl}/todos/${id}/done`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({done})
    });
    if (res.ok) loadTasks();
    else alert('Failed to update task status');
}

window.onload = loadTasks;
</script>

</body>
</html>
